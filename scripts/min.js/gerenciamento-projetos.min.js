$("#percentual-campo").mask("##0,00%",{reverse:!0}),$("#datepicker").datepicker({dateFormat:"dd/mm/yy"});var appGerenciamento=angular.module("appGerenciamento",[]);appGerenciamento.controller("ctrlGerenciamento",["$scope",function(a){var e=new Date;a.listaNaoSelecionada=!0,a.popupNovoBloco=!1,a.projetos=[],a.alimentaProjetos=function(){return a.projetos=[],$.ajax({url:"http://lucasmendoncapportfolio.atwebpages.com/json/projetos.json",success:function(o){for(var t=JSON.parse(o),l=0,r=t.Projetos;l<r.length;l++){var n=r[l],s=n.HorasContratadas-n.HorasUsadas,c=(100*n.HorasUsadas/n.HorasContratadas).toFixed(2)+"%",i=n.Prazo.split("/"),u=new Date(i[1],i[0],i[2]),p=null!=n.Entrega?n.Entrega.split("/"):null,d="",T="";null!=p?(T=n.Entrega,d=u<new Date(p[1],p[0],p[2])?"Sim":"Não"):(T="Não Entregue",d=u<e?"Sim":"Não"),a.projetos.push({Title:n.Nome,Cliente:n.Cliente,GerenteProjeto:n.GerenteProjeto,LiderTecnico:n.LiderTecnico,HorasContratadas:n.HorasContratadas,HorasRestantes:s,HorasUsadas:n.HorasUsadas,HorasUsadasPercent:c,DataInicio:n.Inicio,DataPrazo:n.Prazo,DataEntrega:T,Atraso:d})}}})},a.clientes=[],a.alimentaClientes=function(){return a.clientes=[],$.ajax({url:"http://lucasmendoncapportfolio.atwebpages.com/json/clientes.json",success:function(e){for(var o=JSON.parse(e),t=0,l=o.Clientes;t<l.length;t++){for(var r=l[t],n=0,s=0,c=0,i=0,u=a.projetos;i<u.length;i++){var p=u[i];p.Cliente==r.Nome&&(n++,s+=p.HorasUsadas,c+=p.HorasContratadas)}var d=c-s,T=(100*s/c).toFixed(2)+"%";a.clientes.push({Title:r.Nome,Projetos:n,HorasContratadas:c,HorasRestantes:d,HorasUsadas:T})}}})},a.tarefas=[],a.alimentaTarefas=function(){return a.tarefas=[],$.ajax({url:"http://lucasmendoncapportfolio.atwebpages.com/json/tarefas.json",success:function(e){for(var o=JSON.parse(e),t=0,l=o.Tarefas;t<l.length;t++){var r=l[t];a.tarefas.push({Projeto:r.Projeto,Tarefa:r.Tarefa,Atribuido:r.Atribuido,Inicio:r.Inicio,Entrega:r.Entrega,Status:r.Status})}}})},a.projetosGeral=[],a.alimentaProjetosGerais=function(){a.projetosGeral=[];for(var e=0,o=a.projetos;e<o.length;e++){for(var t=o[e],l=0,r=0,n=0,s=a.tarefas;n<s.length;n++){var c=s[n];t.Title==c.Projeto&&(l++,"Concluida"==c.Status&&r++)}var i=0!=l?(100*r/l).toFixed(2)+"%":"100%";a.projetosGeral.push({Cliente:t.Cliente,Title:t.Title,Gerente:t.GerenteProjeto,Tecnico:t.LiderTecnico,Tarefas:i,Prazo:t.DataPrazo})}},a.dados=[],a.alimentaDados=function(){a.dados=[];for(var e=0,o=a.projetos;e<o.length;e++){for(var t=o[e],l=0,r=0,n=0,s=0,c=0,i=0,u=a.tarefas;i<u.length;i++){var p=u[i];if(t.Title==p.Projeto)switch(c++,p.Status){case"Concluida":l++;break;case"Em Andamento":r++;break;case"Em Aguardo":n++;break;case"Vencida":s++}}var d=0!=l?100*l/c:0,T=0!=r?100*r/c:0,m=0!=n?100*n/c:0,S=0!=s?100*s/c:0;0==c&&(d=100),a.dados.push({Title:t.Title,Cliente:t.Cliente,ConcluidasCount:l,AndamentoCount:r,AguardoCount:n,VencidasCount:s,Concluidas:d.toFixed(2)+"%",Andamento:T.toFixed(2)+"%",Aguardo:m.toFixed(2)+"%",Vencidas:S.toFixed(2)+"%"})}return a.$apply(),a.alimentaContadores(),a.dados},a.contadores=[],a.alimentaContadores=function(){a.contadores=[];for(var e=0,o=0,t=0,l=0,r=0,n=0,s=a.dados;n<s.length;n++){var c=s[n];e+=c.ConcluidasCount+c.AndamentoCount+c.AguardoCount+c.VencidasCount,t+=c.VencidasCount,l+=c.AndamentoCount,o+=c.ConcluidasCount,r+=c.AguardoCount}return a.contadores.push({Title:"Total de tarefas",Quantidade:e},{Title:"Tarefas atrasadas",Quantidade:t},{Title:"Tarefas em andamento",Quantidade:l},{Title:"Tarefas em aguardo",Quantidade:r},{Title:"Tarefas concluídas",Quantidade:o}),a.$apply(),a.contadores},a.selectAba=function(e){"dashboard"==e&&(a.liDashboard="li-selecionada",a.liClientes="",a.liProjetos="",a.liTarefas="",a.dashboardAba="aba-selecionada",a.clientesAba="aba-nao-selecionada",a.projetosAba="aba-nao-selecionada",a.tarefasAba="aba-nao-selecionada"),"clientes"==e&&(a.liDashboard="",a.liClientes="li-selecionada",a.liProjetos="",a.liTarefas="",a.dashboardAba="aba-nao-selecionada",a.clientesAba="aba-selecionada",a.projetosAba="aba-nao-selecionada",a.tarefasAba="aba-nao-selecionada"),"projetos"==e&&(a.liDashboard="",a.liClientes="",a.liProjetos="li-selecionada",a.liTarefas="",a.dashboardAba="aba-nao-selecionada",a.clientesAba="aba-nao-selecionada",a.projetosAba="aba-selecionada",a.tarefasAba="aba-nao-selecionada"),"tarefas"==e&&(a.liDashboard="",a.liClientes="",a.liProjetos="",a.liTarefas="li-selecionada",a.dashboardAba="aba-nao-selecionada",a.clientesAba="aba-nao-selecionada",a.projetosAba="aba-nao-selecionada",a.tarefasAba="aba-selecionada")},a.selectAba("dashboard"),a.alimentaProjetos().done(function(){a.alimentaClientes().done(function(){a.alimentaTarefas().done(function(){a.alimentaProjetosGerais(),a.alimentaDados()})})}),a.addContadorPopUp=function(){a.popupNovoBloco=!0},a.opcoesColunas=[],a.exibeOpcoesColunas=function(){switch(a.opcoesColunas=[],a.listaNaoSelecionada=!1,a.listaSelect){case"Clientes":a.opcoesColunas.push({Title:"Nome",Value:"Title",Type:"texto"},{Title:"Quantidade de Projetos",Value:"Projetos",Type:"numero"},{Title:"Horas Contratadas",Value:"HorasContratadas",Type:"numero"},{Title:"Horas Restantes",Value:"HorasRestantes",Type:"numero"},{Title:"Horas Usadas (Percentual)",Value:"HorasUsadas",Type:"porcentagem"});break;case"Projetos":a.opcoesColunas.push({Title:"Nome",Value:"Title",Type:"texto"},{Title:"Cliente",Value:"Cliente",Type:"texto"},{Title:"Gerente do Projeto",Value:"GerenteProjeto",Type:"texto"},{Title:"Lider Técnico do Projeto",Value:"LiderTecnico",Type:"texto"},{Title:"Horas Contratadas",Value:"HorasContratadas",Type:"numero"},{Title:"Horas Restantes",Value:"HorasRestantes",Type:"numero"},{Title:"Horas Usadas",Value:"HorasUsadas",Type:"numero"},{Title:"Horas Usadas (Percentual)",Value:"HorasUsadasPercent",Type:"porcentagem"},{Title:"Data de Ínicio",Value:"DataInicio",Type:"data"},{Title:"Data Prazo",Value:"DataPrazo",Type:"data"},{Title:"Data de Entrega",Value:"DataEntrega",Type:"data"},{Title:"Atraso (Sim/Não)",Value:"Atraso",Type:"sim/nao"});break;case"Tarefas":a.opcoesColunas.push({Title:"Nome",Value:"Title",Type:"texto"},{Title:"Projeto",Value:"Projeto",Type:"texto"},{Title:"Atribuido",Value:"Atribuido",Type:"texto"},{Title:"Data de Ínicio",Value:"Inicio",Type:"data"},{Title:"Data de Entrega",Value:"Entrega",Type:"data"},{Title:"Status da Tarefa",Value:"Status",Type:"status"})}},a.comparacoes=[],a.alteraColuna=function(){a.comparacoes=[],a.comparacaoSelect="","status"!=a.colunaSelect.Type&&"sim/nao"!=a.colunaSelect.Type&&"texto"!=a.colunaSelect.Type?a.comparacoes.push({Title:"Igual"},{Title:"Diferente"},{Title:"Maior"},{Title:"Menor"},{Title:"Maior ou Igual"},{Title:"Menor ou Igual"}):a.comparacoes.push({Title:"Igual"},{Title:"Diferente"})},a.alertCampos=!1,a.salvarContador=function(){var e=[];"Clientes"==a.listaSelect&&(e=a.clientes),"Projetos"==a.listaSelect&&(e=a.projetos),"Tarefas"==a.listaSelect&&(e=a.tarefas),a.tituloBloco&&a.listaSelect&&a.colunaSelect&&a.comparacaoSelect?(a.comparacao(e),a.alertCampos=!1):a.alertCampos=!0},a.comparacao=function(e){for(var o=0,t=0,l=e;t<l.length;t++){var r=l[t];if("texto"==a.colunaSelect.Type)"Igual"==a.comparacaoSelect.Title?r[a.colunaSelect.Value]==a.compararTexto&&o++:r[a.colunaSelect.Value]!=a.compararTexto&&o++;else if("status"==a.colunaSelect.Type)"Igual"==a.comparacaoSelect.Title?r[a.colunaSelect.Value]==a.compararStatus&&o++:r[a.colunaSelect.Value]!=a.compararStatus&&o++;else if("sim/nao"==a.colunaSelect.Type)"Igual"==a.comparacaoSelect.Title?r[a.colunaSelect.Value]==a.compararSimNao&&o++:r[a.colunaSelect.Value]!=a.compararSimNao&&o++;else if("numero"==a.colunaSelect.Type)"Igual"==a.comparacaoSelect.Title?r[a.colunaSelect.Value]==a.compararNumero&&o++:"Diferente"==a.comparacaoSelect.Title?r[a.colunaSelect.Value]!=a.compararNumero&&o++:"Maior"==a.comparacaoSelect.Title?r[a.colunaSelect.Value]>a.compararNumero&&o++:"Menor"==a.comparacaoSelect.Title?r[a.colunaSelect.Value]<a.compararNumero&&o++:"Maior ou Igual"==a.comparacaoSelect.Title?r[a.colunaSelect.Value]>=a.compararNumero&&o++:"Menor ou Igual"==a.comparacaoSelect.Title&&r[a.colunaSelect.Value]<=a.compararNumero&&o++;else if("porcentagem"==a.colunaSelect.Type){var n=parseFloat(r[a.colunaSelect.Value].split("%")[0]),s=parseFloat(a.compararPorcentagem.split("%")[0]);"Igual"==a.comparacaoSelect.Title?n==s&&o++:"Diferente"==a.comparacaoSelect.Title?n!=s&&o++:"Maior"==a.comparacaoSelect.Title?n>s&&o++:"Menor"==a.comparacaoSelect.Title?n<s&&o++:"Maior ou Igual"==a.comparacaoSelect.Title?n>=s&&o++:"Menor ou Igual"==a.comparacaoSelect.Title&&n<=s&&o++}else if("data"==a.colunaSelect.Type){var c=r[a.colunaSelect.Value].split("/"),i=new Date(c[2],parseInt(c[1])-1,c[0]).getTime(),u=a.compararData.split("/"),p=new Date(u[2],parseInt(u[1])-1,u[0]).getTime();"Igual"==a.comparacaoSelect.Title?i==p&&o++:"Diferente"==a.comparacaoSelect.Title?i!=p&&o++:"Maior"==a.comparacaoSelect.Title?i>p&&o++:"Menor"==a.comparacaoSelect.Title?i<p&&o++:"Maior ou Igual"==a.comparacaoSelect.Title?i>=p&&o++:"Menor ou Igual"==a.comparacaoSelect.Title&&i<=p&&o++}}a.contadores.push({Title:a.tituloBloco,Quantidade:o}),a.cancelarContador()},a.cancelarContador=function(){a.popupNovoBloco=!1,a.listaSelect="",a.tituloBloco="",a.colunaSelect="",a.comparacaoSelect="",a.compararTexto="",a.compararPorcentagem="",a.compararNumero="",a.compararData="",a.compararSimNao="",a.compararStatus="",a.listaNaoSelecionada=!0}}]);
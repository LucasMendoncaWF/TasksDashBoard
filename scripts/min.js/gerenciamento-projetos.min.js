var appGerenciamento=angular.module("appGerenciamento",[]);appGerenciamento.controller("ctrlGerenciamento",["$scope",function(a){var e=new Date;a.projetos=[],a.alimentaProjetos=function(){return a.projetos=[],$.ajax({url:"http://localhost:3000/Projetos",success:function(o){for(var t=0,n=o;t<n.length;t++){var s=n[t],r=s.HorasContratadas-s.HorasUsadas,i=(100*s.HorasUsadas/s.HorasContratadas).toFixed(2)+"%",l=s.Prazo.split("/"),d=new Date(l[1],l[0],l[2]),c=null!=s.Entrega?s.Entrega.split("/"):null,u="",f="";null!=c?(f=s.Entrega,u=d<new Date(c[1],c[0],c[2])?"Sim":"Não"):(f="Não Entregue",u=d<e?"Sim":"Não"),a.projetos.push({Title:s.Nome,Cliente:s.Cliente,GerenteProjeto:s.GerenteProjeto,LiderTecnico:s.LiderTecnico,HorasContratadas:s.HorasContratadas,HorasRestantes:r,HorasUsadas:s.HorasUsadas,HorasUsadasPercent:i,DataInicio:s.Inicio,DataPrazo:s.Prazo,DataEntrega:f,Atraso:u})}}})},a.clientes=[],a.alimentaClientes=function(){return a.clientes=[],$.ajax({url:"http://localhost:3000/Clientes",success:function(e){for(var o=0,t=e;o<t.length;o++){for(var n=t[o],s=0,r=0,i=0,l=0,d=a.projetos;l<d.length;l++){var c=d[l];c.Cliente==n.Nome&&(s++,r+=c.HorasUsadas,i+=c.HorasContratadas)}var u=i-r,f=(100*r/i).toFixed(2)+"%";a.clientes.push({Title:n.Nome,Projetos:s,HorasContratadas:i,HorasRestantes:u,HorasUsadas:f})}}})},a.tarefas=[],a.alimentaTarefas=function(){return a.tarefas=[],$.ajax({url:"http://localhost:3000/Tarefas",success:function(e){for(var o=0,t=e;o<t.length;o++){var n=t[o];a.tarefas.push({Projeto:n.Projeto,Tarefa:n.Tarefa,Atribuido:n.Atribuido,Inicio:n.Inicio,Entrega:n.Entrega,Status:n.Status})}}})},a.projetosGeral=[],a.alimentaProjetosGerais=function(){a.projetosGeral=[];for(var e=0,o=a.projetos;e<o.length;e++){for(var t=o[e],n=0,s=0,r=0,i=a.tarefas;r<i.length;r++){var l=i[r];t.Title==l.Projeto&&(n++,"Concluida"==l.Status&&s++)}var d=0!=n?(100*s/n).toFixed(2)+"%":"100%";a.projetosGeral.push({Cliente:t.Cliente,Title:t.Title,Gerente:t.GerenteProjeto,Tecnico:t.LiderTecnico,Tarefas:d,Prazo:t.DataPrazo})}},a.dados=[],a.alimentaDados=function(){a.dados=[];for(var e=0,o=a.projetos;e<o.length;e++){for(var t=o[e],n=0,s=0,r=0,i=0,l=0,d=0,c=a.tarefas;d<c.length;d++){var u=c[d];if(t.Title==u.Projeto)switch(l++,u.Status){case"Concluida":n++;break;case"Em Andamento":s++;break;case"Em Aguardo":r++;break;case"Vencida":i++}}var f=0!=n?100*n/l:0,b=0!=s?100*s/l:0,p=0!=r?100*r/l:0,h=0!=i?100*i/l:0;0==l&&(f=100),a.dados.push({Title:t.Title,Cliente:t.Cliente,Concluidas:f.toFixed(2)+"%",Andamento:b.toFixed(2)+"%",Aguardo:p.toFixed(2)+"%",Vencidas:h.toFixed(2)+"%"})}a.$apply()},a.contadores=[],a.alimentaContadores=function(){a.contadores=[];for(var e=0,o=0,t=a.dados;o<t.length;o++){var n=t[o];e+=n.Concluidas+n.Andamento+n.Aguardo+n.Vencidas}for(var s=0,r=0,i=a.dados;r<i.length;r++){var n=i[r];s+=n.Vencidas}for(var l=0,d=0,c=a.dados;d<c.length;d++){var n=c[d];l+=n.Andamento}for(var u=0,f=0,b=a.dados;f<b.length;f++){var n=b[f];u+=n.Concluidas}return a.contadores.push({Title:"Total de tarefas",Quantidade:e},{Title:"Tarefas atrasadas",Quantidade:s},{Title:"Tarefas em andamento",Quantidade:l},{Title:"Tarefas concluídas",Quantidade:u}),a.$apply(),a.contadores},a.selectAba=function(e){"dashboard"==e&&(a.liDashboard="li-selecionada",a.liClientes="",a.liProjetos="",a.liTarefas="",a.dashboardAba="aba-selecionada",a.clientesAba="aba-nao-selecionada",a.projetosAba="aba-nao-selecionada",a.tarefasAba="aba-nao-selecionada"),"clientes"==e&&(a.liDashboard="",a.liClientes="li-selecionada",a.liProjetos="",a.liTarefas="",a.dashboardAba="aba-nao-selecionada",a.clientesAba="aba-selecionada",a.projetosAba="aba-nao-selecionada",a.tarefasAba="aba-nao-selecionada"),"projetos"==e&&(a.liDashboard="",a.liClientes="",a.liProjetos="li-selecionada",a.liTarefas="",a.dashboardAba="aba-nao-selecionada",a.clientesAba="aba-nao-selecionada",a.projetosAba="aba-selecionada",a.tarefasAba="aba-nao-selecionada"),"tarefas"==e&&(a.liDashboard="",a.liClientes="",a.liProjetos="",a.liTarefas="li-selecionada",a.dashboardAba="aba-nao-selecionada",a.clientesAba="aba-nao-selecionada",a.projetosAba="aba-nao-selecionada",a.tarefasAba="aba-selecionada")},a.selectAba("dashboard"),a.alimentaProjetos().done(function(){a.alimentaClientes().done(function(){a.alimentaTarefas().done(function(){a.alimentaProjetosGerais(),a.alimentaDados()})})}),a.popupNovoBloco=!1,a.addContadorPopUp=function(){a.popupNovoBloco=!0}}]);
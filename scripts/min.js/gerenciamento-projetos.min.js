var appGerenciamento=angular.module("appGerenciamento",[]);appGerenciamento.controller("ctrlGerenciamento",["$scope",function(a){var e=new Date;a.listaNaoSelecionada=!0,a.popupNovoBloco=!1,a.projetos=[],a.alimentaProjetos=function(){return a.projetos=[],$.ajax({url:"http://localhost:3000/Projetos",success:function(o){for(var t=0,r=o;t<r.length;t++){var s=r[t],l=s.HorasContratadas-s.HorasUsadas,n=(100*s.HorasUsadas/s.HorasContratadas).toFixed(2)+"%",i=s.Prazo.split("/"),c=new Date(i[1],i[0],i[2]),u=null!=s.Entrega?s.Entrega.split("/"):null,d="",T="";null!=u?(T=s.Entrega,d=c<new Date(u[1],u[0],u[2])?"Sim":"Não"):(T="Não Entregue",d=c<e?"Sim":"Não"),a.projetos.push({Title:s.Nome,Cliente:s.Cliente,GerenteProjeto:s.GerenteProjeto,LiderTecnico:s.LiderTecnico,HorasContratadas:s.HorasContratadas,HorasRestantes:l,HorasUsadas:s.HorasUsadas,HorasUsadasPercent:n,DataInicio:s.Inicio,DataPrazo:s.Prazo,DataEntrega:T,Atraso:d})}}})},a.clientes=[],a.alimentaClientes=function(){return a.clientes=[],$.ajax({url:"http://localhost:3000/Clientes",success:function(e){for(var o=0,t=e;o<t.length;o++){for(var r=t[o],s=0,l=0,n=0,i=0,c=a.projetos;i<c.length;i++){var u=c[i];u.Cliente==r.Nome&&(s++,l+=u.HorasUsadas,n+=u.HorasContratadas)}var d=n-l,T=(100*l/n).toFixed(2)+"%";a.clientes.push({Title:r.Nome,Projetos:s,HorasContratadas:n,HorasRestantes:d,HorasUsadas:T})}}})},a.tarefas=[],a.alimentaTarefas=function(){return a.tarefas=[],$.ajax({url:"http://localhost:3000/Tarefas",success:function(e){for(var o=0,t=e;o<t.length;o++){var r=t[o];a.tarefas.push({Projeto:r.Projeto,Tarefa:r.Tarefa,Atribuido:r.Atribuido,Inicio:r.Inicio,Entrega:r.Entrega,Status:r.Status})}}})},a.projetosGeral=[],a.alimentaProjetosGerais=function(){a.projetosGeral=[];for(var e=0,o=a.projetos;e<o.length;e++){for(var t=o[e],r=0,s=0,l=0,n=a.tarefas;l<n.length;l++){var i=n[l];t.Title==i.Projeto&&(r++,"Concluida"==i.Status&&s++)}var c=0!=r?(100*s/r).toFixed(2)+"%":"100%";a.projetosGeral.push({Cliente:t.Cliente,Title:t.Title,Gerente:t.GerenteProjeto,Tecnico:t.LiderTecnico,Tarefas:c,Prazo:t.DataPrazo})}},a.dados=[],a.alimentaDados=function(){a.dados=[];for(var e=0,o=a.projetos;e<o.length;e++){for(var t=o[e],r=0,s=0,l=0,n=0,i=0,c=0,u=a.tarefas;c<u.length;c++){var d=u[c];if(t.Title==d.Projeto)switch(i++,d.Status){case"Concluida":r++;break;case"Em Andamento":s++;break;case"Em Aguardo":l++;break;case"Vencida":n++}}var T=0!=r?100*r/i:0,p=0!=s?100*s/i:0,f=0!=l?100*l/i:0,m=0!=n?100*n/i:0;0==i&&(T=100),a.dados.push({Title:t.Title,Cliente:t.Cliente,ConcluidasCount:r,AndamentoCount:s,AguardoCount:l,VencidasCount:n,Concluidas:T.toFixed(2)+"%",Andamento:p.toFixed(2)+"%",Aguardo:f.toFixed(2)+"%",Vencidas:m.toFixed(2)+"%"})}return a.$apply(),a.alimentaContadores(),a.dados},a.contadores=[],a.alimentaContadores=function(){a.contadores=[];for(var e=0,o=0,t=0,r=0,s=0,l=0,n=a.dados;l<n.length;l++){var i=n[l];e+=i.ConcluidasCount+i.AndamentoCount+i.AguardoCount+i.VencidasCount,t+=i.VencidasCount,r+=i.AndamentoCount,o+=i.ConcluidasCount,s+=i.AguardoCount}return a.contadores.push({Title:"Total de tarefas",Quantidade:e},{Title:"Tarefas atrasadas",Quantidade:t},{Title:"Tarefas em andamento",Quantidade:r},{Title:"Tarefas em aguardo",Quantidade:s},{Title:"Tarefas concluídas",Quantidade:o}),a.$apply(),a.contadores},a.selectAba=function(e){"dashboard"==e&&(a.liDashboard="li-selecionada",a.liClientes="",a.liProjetos="",a.liTarefas="",a.dashboardAba="aba-selecionada",a.clientesAba="aba-nao-selecionada",a.projetosAba="aba-nao-selecionada",a.tarefasAba="aba-nao-selecionada"),"clientes"==e&&(a.liDashboard="",a.liClientes="li-selecionada",a.liProjetos="",a.liTarefas="",a.dashboardAba="aba-nao-selecionada",a.clientesAba="aba-selecionada",a.projetosAba="aba-nao-selecionada",a.tarefasAba="aba-nao-selecionada"),"projetos"==e&&(a.liDashboard="",a.liClientes="",a.liProjetos="li-selecionada",a.liTarefas="",a.dashboardAba="aba-nao-selecionada",a.clientesAba="aba-nao-selecionada",a.projetosAba="aba-selecionada",a.tarefasAba="aba-nao-selecionada"),"tarefas"==e&&(a.liDashboard="",a.liClientes="",a.liProjetos="",a.liTarefas="li-selecionada",a.dashboardAba="aba-nao-selecionada",a.clientesAba="aba-nao-selecionada",a.projetosAba="aba-nao-selecionada",a.tarefasAba="aba-selecionada")},a.selectAba("dashboard"),a.alimentaProjetos().done(function(){a.alimentaClientes().done(function(){a.alimentaTarefas().done(function(){a.alimentaProjetosGerais(),a.alimentaDados()})})}),a.addContadorPopUp=function(){a.popupNovoBloco=!0},a.opcoesColunas=[],a.exibeOpcoesColunas=function(){switch(a.opcoesColunas=[],a.listaNaoSelecionada=!1,a.listaSelect){case"Clientes":a.opcoesColunas.push({Title:"Nome",Value:"Title",Type:"texto"},{Title:"Quantidade de Projetos",Value:"Projetos",Type:"numero"},{Title:"Horas Contratadas",Value:"HorasContratadas",Type:"numero"},{Title:"Horas Restantes",Value:"HorasRestantes",Type:"numero"},{Title:"Horas Usadas (Percentual)",Value:"HorasUsadas",Type:"porcentagem"});break;case"Projetos":a.opcoesColunas.push({Title:"Nome",Value:"Title",Type:"texto"},{Title:"Cliente",Value:"Cliente",Type:"texto"},{Title:"Gerente do Projeto",Value:"GerenteProjeto",Type:"texto"},{Title:"Lider Técnico do Projeto",Value:"LiderTecnico",Type:"texto"},{Title:"Horas Contratadas",Value:"HorasContratadas",Type:"numero"},{Title:"Horas Restantes",Value:"HorasRestantes",Type:"numero"},{Title:"Horas Usadas",Value:"HorasUsadas",Type:"numero"},{Title:"Horas Usadas (Percentual)",Value:"HorasUsadasPercent",Type:"porcentagem"},{Title:"Data de Ínicio",Value:"DataInicio",Type:"data"},{Title:"Data Prazo",Value:"DataPrazo",Type:"data"},{Title:"Data de Entrega",Value:"DataEntrega",Type:"data"},{Title:"Atraso (Sim/Não)",Value:"Atraso",Type:"sim/nao"});break;case"Tarefas":a.opcoesColunas.push({Title:"Nome",Value:"Title",Type:"texto"},{Title:"Projeto",Value:"Projeto",Type:"texto"},{Title:"Atribuido",Value:"Atribuido",Type:"texto"},{Title:"Data de Ínicio",Value:"Inicio",Type:"data"},{Title:"Data de Entrega",Value:"Entrega",Type:"data"},{Title:"Status da Tarefa",Value:"Status",Type:"status"})}},a.comparacoes=[],a.alteraColuna=function(){a.comparacoes=[],a.comparacaoSelect="","status"!=a.colunaSelect.Type&&"sim/nao"!=a.colunaSelect.Type&&"texto"!=a.colunaSelect.Type?a.comparacoes.push({Title:"Igual"},{Title:"Diferente"},{Title:"Maior"},{Title:"Menor"},{Title:"Maior ou Igual"},{Title:"Menor ou Igual"}):a.comparacoes.push({Title:"Igual"},{Title:"Diferente"})},a.salvarContador=function(){var e=0;if("Clientes"==a.listaSelect&&"texto"==a.colunaSelect.Type)if("Igual"==a.comparacaoSelect.Title)for(var o=0,t=a.clientes;o<t.length;o++){var r=t[o];r[a.colunaSelect.Value]==a.compararTexto&&e++}else for(var s=0,l=a.clientes;s<l.length;s++){var r=l[s];r[a.colunaSelect.Value]!=a.compararTexto&&e++}if("Projetos"==a.listaSelect&&"texto"==a.colunaSelect.Type)if("Igual"==a.comparacaoSelect.Title)for(var n=0,i=a.projetos;n<i.length;n++){var c=i[n];c[a.colunaSelect.Value]==a.compararTexto&&e++}else for(var u=0,d=a.projetos;u<d.length;u++){var c=d[u];c[a.colunaSelect.Value]!=a.compararTexto&&e++}if("Tarefas"==a.listaSelect&&"texto"==a.colunaSelect.Type)if("Igual"==a.comparacaoSelect.Title)for(var T=0,p=a.tarefas;T<p.length;T++){var f=p[T];f[a.colunaSelect.Value]==a.compararTexto&&e++}else for(var m=0,C=a.tarefas;m<C.length;m++){var f=C[m];f[a.colunaSelect.Value]!=a.compararTexto&&e++}a.contadores.push({Title:a.tituloBloco,Quantidade:e}),a.popupNovoBloco=!1,a.listaSelect="",a.tituloBloco="",a.colunaSelect="",a.comparacaoSelect="",a.listaNaoSelecionada=!0}}]);